<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®ç®¡ç† - æ¸¸æˆæ•°æ®åº“</title>
    <style>
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
        }

        .login-box h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .login-form input {
            width: 100%;
            padding: 12px 15px;
            font-size: 1em;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
        }

        .login-form input:focus {
            border-color: #667eea;
        }

        .login-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }

        .login-button:hover {
            background: #5568d3;
        }

        .login-error {
            background: #f8d7da;
            color: #721c24;
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 15px;
            display: none;
        }

        .admin-content {
            display: none;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .nav-bar {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-bar a {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.3s;
        }

        .nav-bar a:hover {
            color: #5568d3;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            font-size: 1em;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #667eea;
        }

        .form-group textarea {
            min-height: 120px;
            font-family: inherit;
            resize: vertical;
        }

        .form-help {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
        }

        .button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .button:hover {
            background: #5568d3;
        }

        .button-success {
            background: #28a745;
        }

        .button-success:hover {
            background: #218838;
        }

        .button-secondary {
            background: #6c757d;
        }

        .button-secondary:hover {
            background: #5a6268;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .preview-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .preview-box h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .preview-content {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }

        .current-fields {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .field-tag {
            background: #e7f3ff;
            color: #0066cc;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
        }

        .command-box {
            background: #2d2d2d;
            color: #f8f8f2;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .command-box h3 {
            color: #f92672;
            margin-bottom: 15px;
        }

        .command-content {
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.2em;
            padding: 40px;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            color: #155724;
            margin-top: 15px;
        }

        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 8px;
            padding: 15px;
            color: #721c24;
            margin-top: 15px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 1em;
            color: #666;
            transition: all 0.3s;
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- ç™»å½•ç•Œé¢ -->
    <div id="loginContainer" class="login-container">
        <div class="login-box">
            <h1>ğŸ” ç®¡ç†åå°ç™»å½•</h1>
            <div id="loginError" class="login-error">è´¦å·æˆ–å¯†ç é”™è¯¯</div>
            <form class="login-form" onsubmit="handleLogin(event)">
                <input type="text" id="username" placeholder="è´¦å·" required autocomplete="username">
                <input type="password" id="password" placeholder="å¯†ç " required autocomplete="current-password">
                <button type="submit" class="login-button">ç™»å½•</button>
            </form>
                <a href="index.html" style="color: #667eea;">â† è¿”å›é¦–é¡µ</a>
            </p>
        </div>
    </div>

    <!-- ç®¡ç†å†…å®¹ -->
    <div id="adminContent" class="admin-content">
    <div class="container">
        <h1>âš™ï¸ æ•°æ®ç®¡ç†</h1>

        <!-- å¯¼èˆªæ  -->
        <div class="nav-bar">
            <span>ğŸ® æ¸¸æˆæ•°æ®åº“ç®¡ç†åå°</span>
            <div>
                <a href="index.html">æ¸¸æˆåˆ—è¡¨</a> |
                <a href="updates.html">æ›´æ–°æ—¥å¿—</a> |
                <a href="#" onclick="logout()" style="color: #dc3545;">é€€å‡ºç™»å½•</a>
            </div>
        </div>

        <!-- æ·»åŠ /æ›´æ–°æ•°æ® -->
        <div class="card">
            <h2>ğŸ“ æ·»åŠ /æ›´æ–°æ¸¸æˆæ•°æ®</h2>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('add')">æ·»åŠ æ•°æ®</button>
                <button class="tab" onclick="switchTab('batch')">æ‰¹é‡æ·»åŠ </button>
            </div>

            <!-- æ·»åŠ å•ä¸ªæ•°æ® -->
            <div id="tab-add" class="tab-content active">
                <div class="form-group">
                    <label for="gameSelect">é€‰æ‹©æ¸¸æˆ</label>
                    <select id="gameSelect" onchange="loadGameData()">
                        <option value="">æ­£åœ¨åŠ è½½æ¸¸æˆåˆ—è¡¨...</option>
                    </select>
                    <div class="form-help">å½“å‰æ¸¸æˆçš„æ‰€æœ‰å­—æ®µå°†åœ¨ä¸‹æ–¹æ˜¾ç¤º</div>
                </div>

                <div id="currentFieldsBox" class="hidden">
                    <div class="form-group">
                        <label>å½“å‰å­—æ®µåˆ—è¡¨</label>
                        <div id="currentFields" class="current-fields"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="fieldName">å­—æ®µåç§°</label>
                    <input type="text" id="fieldName" placeholder="ä¾‹å¦‚: Så¿ã€Aè½¦ã€æ­¦å™¨ã€çš®è‚¤ç­‰" list="existingFields">
                    <datalist id="existingFields"></datalist>
                    <div class="form-help">è¾“å…¥ç°æœ‰å­—æ®µåæˆ–åˆ›å»ºæ–°å­—æ®µ</div>
                </div>

                <div class="form-group">
                    <label for="fieldValue">å­—æ®µå€¼ï¼ˆæ”¯æŒå¤šä¸ªï¼‰</label>
                    <textarea id="fieldValue" placeholder="æ¯è¡Œä¸€ä¸ªå€¼ï¼Œä¾‹å¦‚ï¼š&#10;æ–°è§’è‰²A&#10;æ–°è§’è‰²B&#10;æ–°è§’è‰²C"></textarea>
                    <div class="form-help">æ¯è¡Œè¾“å…¥ä¸€ä¸ªå€¼ï¼Œæ”¯æŒä¸€æ¬¡æ·»åŠ å¤šä¸ª</div>
                </div>

                <div class="button-group">
                    <button class="button button-success" onclick="addData()">â• æ·»åŠ æ•°æ®</button>
                    <button class="button button-secondary" onclick="clearForm()">æ¸…ç©ºè¡¨å•</button>
                </div>
            </div>

            <!-- æ‰¹é‡æ·»åŠ  -->
            <div id="tab-batch" class="tab-content">
                <div class="form-group">
                    <label for="batchGameSelect">é€‰æ‹©æ¸¸æˆ</label>
                    <select id="batchGameSelect" onchange="loadBatchGameData()">
                        <option value="">æ­£åœ¨åŠ è½½æ¸¸æˆåˆ—è¡¨...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="batchData">æ‰¹é‡æ•°æ®ï¼ˆJSONæ ¼å¼ï¼‰</label>
                    <textarea id="batchData" placeholder='{
  "Så¿": "æ–°è§’è‰²A",
  "Aå¿": "æ–°è§’è‰²B",
  "çš®è‚¤": ["çš®è‚¤1", "çš®è‚¤2", "çš®è‚¤3"]
}'></textarea>
                    <div class="form-help">ä½¿ç”¨JSONæ ¼å¼ï¼Œæ”¯æŒå•ä¸ªå€¼æˆ–æ•°ç»„</div>
                </div>

                <div class="button-group">
                    <button class="button button-success" onclick="batchAddData()">ğŸ“¦ æ‰¹é‡æ·»åŠ </button>
                    <button class="button" onclick="loadBatchTemplate()">åŠ è½½æ¨¡æ¿</button>
                </div>
            </div>

            <!-- é¢„è§ˆåŒºåŸŸ -->
            <div id="previewBox" class="hidden">
                <div class="preview-box">
                    <h3>ğŸ“‹ æ›´æ–°é¢„è§ˆ</h3>
                    <div id="previewContent" class="preview-content"></div>
                </div>
            </div>

            <!-- ä¸‹è½½åŒºåŸŸ -->
            <div id="downloadBox" class="hidden">
                <div class="button-group" style="margin-top: 20px;">
                    <button class="button button-success" onclick="downloadJSON()">ğŸ“¥ ä¸‹è½½æ›´æ–°åçš„JSON</button>
                    <button class="button" onclick="downloadPythonScript()">ğŸ ä¸‹è½½Pythonè„šæœ¬</button>
                </div>
            </div>

            <!-- Gitå‘½ä»¤åŒºåŸŸ -->
            <div id="commandBox" class="hidden">
                <div class="command-box">
                    <h3>ğŸ’» Gitæäº¤å‘½ä»¤</h3>
                    <div id="commandContent" class="command-content"></div>
                </div>
            </div>

            <!-- æ¶ˆæ¯åŒºåŸŸ -->
            <div id="messageBox"></div>
        </div>

        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="card">
            <h2>ğŸ“– ä½¿ç”¨è¯´æ˜</h2>
            <div style="color: #666; line-height: 1.8;">
                <p><strong>1. æ·»åŠ æ•°æ®æµç¨‹ï¼š</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>é€‰æ‹©è¦æ›´æ–°çš„æ¸¸æˆ</li>
                    <li>è¾“å…¥å­—æ®µåç§°ï¼ˆå¦‚ï¼šSå¿ã€æ­¦å™¨ã€çš®è‚¤ç­‰ï¼‰</li>
                    <li>è¾“å…¥è¦æ·»åŠ çš„å€¼ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</li>
                    <li>ç‚¹å‡»"æ·»åŠ æ•°æ®"é¢„è§ˆæ›´æ–°</li>
                    <li>ä¸‹è½½æ›´æ–°åçš„JSONæ–‡ä»¶æˆ–Pythonè„šæœ¬</li>
                </ul>

                <p><strong>2. æ›´æ–°åˆ°GitHubï¼š</strong></p>
                <ul style="margin-left: 20px; margin-bottom: 15px;">
                    <li>æ–¹æ³•1ï¼šä¸‹è½½JSONæ–‡ä»¶ï¼Œæ›¿æ¢æœ¬åœ°æ–‡ä»¶åæäº¤</li>
                    <li>æ–¹æ³•2ï¼šä¸‹è½½Pythonè„šæœ¬ï¼Œè¿è¡Œåè‡ªåŠ¨æ›´æ–°</li>
                    <li>ä½¿ç”¨æä¾›çš„Gitå‘½ä»¤æäº¤æ›´æ”¹</li>
                </ul>

                <p><strong>3. æ³¨æ„äº‹é¡¹ï¼š</strong></p>
                <ul style="margin-left: 20px;">
                    <li>æ‰€æœ‰æ·»åŠ éƒ½ä¼šè‡ªåŠ¨å»é‡</li>
                    <li>æ›´æ–°ä¼šè‡ªåŠ¨è®°å½•åˆ°updates.json</li>
                    <li>å»ºè®®å…ˆé¢„è§ˆå†ä¸‹è½½</li>
                </ul>
            </div>
        </div>
    </div>
    </div>

    <script>
        // ç™»å½•éªŒè¯é…ç½®ï¼ˆä½¿ç”¨ç®€å•å“ˆå¸Œä¿æŠ¤å¯†ç ï¼‰
        const AUTH_CONFIG = {
            // ç”¨æˆ·åå’Œå¯†ç çš„å“ˆå¸Œå€¼ï¼ˆå®é™…ä½¿ç”¨æ—¶åº”è¯¥æ›´æ¢è¿™äº›å€¼ï¼‰
            // é»˜è®¤è´¦å·: admin / admin123
            usernameHash: '21232f297a57a5a743894a0e4a801fc3', // MD5 of 'admin'
            passwordHash: '0192023a7bbd73250516f069df18b500',  // MD5 of 'admin123'
            sessionKey: 'admin_session',
            sessionDuration: 8 * 60 * 60 * 1000 // 8å°æ—¶
        };

        // ç®€å•MD5å®ç°ï¼ˆç”¨äºå¯†ç éªŒè¯ï¼‰
        function simpleMD5(string) {
            function md5cycle(x, k) {
                var a = x[0], b = x[1], c = x[2], d = x[3];
                a = ff(a, b, c, d, k[0], 7, -680876936);
                d = ff(d, a, b, c, k[1], 12, -389564586);
                c = ff(c, d, a, b, k[2], 17, 606105819);
                b = ff(b, c, d, a, k[3], 22, -1044525330);
                a = ff(a, b, c, d, k[4], 7, -176418897);
                d = ff(d, a, b, c, k[5], 12, 1200080426);
                c = ff(c, d, a, b, k[6], 17, -1473231341);
                b = ff(b, c, d, a, k[7], 22, -45705983);
                a = ff(a, b, c, d, k[8], 7, 1770035416);
                d = ff(d, a, b, c, k[9], 12, -1958414417);
                c = ff(c, d, a, b, k[10], 17, -42063);
                b = ff(b, c, d, a, k[11], 22, -1990404162);
                a = ff(a, b, c, d, k[12], 7, 1804603682);
                d = ff(d, a, b, c, k[13], 12, -40341101);
                c = ff(c, d, a, b, k[14], 17, -1502002290);
                b = ff(b, c, d, a, k[15], 22, 1236535329);
                a = gg(a, b, c, d, k[1], 5, -165796510);
                d = gg(d, a, b, c, k[6], 9, -1069501632);
                c = gg(c, d, a, b, k[11], 14, 643717713);
                b = gg(b, c, d, a, k[0], 20, -373897302);
                a = gg(a, b, c, d, k[5], 5, -701558691);
                d = gg(d, a, b, c, k[10], 9, 38016083);
                c = gg(c, d, a, b, k[15], 14, -660478335);
                b = gg(b, c, d, a, k[4], 20, -405537848);
                a = gg(a, b, c, d, k[9], 5, 568446438);
                d = gg(d, a, b, c, k[14], 9, -1019803690);
                c = gg(c, d, a, b, k[3], 14, -187363961);
                b = gg(b, c, d, a, k[8], 20, 1163531501);
                a = gg(a, b, c, d, k[13], 5, -1444681467);
                d = gg(d, a, b, c, k[2], 9, -51403784);
                c = gg(c, d, a, b, k[7], 14, 1735328473);
                b = gg(b, c, d, a, k[12], 20, -1926607734);
                a = hh(a, b, c, d, k[5], 4, -378558);
                d = hh(d, a, b, c, k[8], 11, -2022574463);
                c = hh(c, d, a, b, k[11], 16, 1839030562);
                b = hh(b, c, d, a, k[14], 23, -35309556);
                a = hh(a, b, c, d, k[1], 4, -1530992060);
                d = hh(d, a, b, c, k[4], 11, 1272893353);
                c = hh(c, d, a, b, k[7], 16, -155497632);
                b = hh(b, c, d, a, k[10], 23, -1094730640);
                a = hh(a, b, c, d, k[13], 4, 681279174);
                d = hh(d, a, b, c, k[0], 11, -358537222);
                c = hh(c, d, a, b, k[3], 16, -722521979);
                b = hh(b, c, d, a, k[6], 23, 76029189);
                a = hh(a, b, c, d, k[9], 4, -640364487);
                d = hh(d, a, b, c, k[12], 11, -421815835);
                c = hh(c, d, a, b, k[15], 16, 530742520);
                b = hh(b, c, d, a, k[2], 23, -995338651);
                a = ii(a, b, c, d, k[0], 6, -198630844);
                d = ii(d, a, b, c, k[7], 10, 1126891415);
                c = ii(c, d, a, b, k[14], 15, -1416354905);
                b = ii(b, c, d, a, k[5], 21, -57434055);
                a = ii(a, b, c, d, k[12], 6, 1700485571);
                d = ii(d, a, b, c, k[3], 10, -1894986606);
                c = ii(c, d, a, b, k[10], 15, -1051523);
                b = ii(b, c, d, a, k[1], 21, -2054922799);
                a = ii(a, b, c, d, k[8], 6, 1873313359);
                d = ii(d, a, b, c, k[15], 10, -30611744);
                c = ii(c, d, a, b, k[6], 15, -1560198380);
                b = ii(b, c, d, a, k[13], 21, 1309151649);
                a = ii(a, b, c, d, k[4], 6, -145523070);
                d = ii(d, a, b, c, k[11], 10, -1120210379);
                c = ii(c, d, a, b, k[2], 15, 718787259);
                b = ii(b, c, d, a, k[9], 21, -343485551);
                x[0] = add32(a, x[0]);
                x[1] = add32(b, x[1]);
                x[2] = add32(c, x[2]);
                x[3] = add32(d, x[3]);
            }

            function cmn(q, a, b, x, s, t) {
                a = add32(add32(a, q), add32(x, t));
                return add32((a << s) | (a >>> (32 - s)), b);
            }

            function ff(a, b, c, d, x, s, t) {
                return cmn((b & c) | ((~b) & d), a, b, x, s, t);
            }

            function gg(a, b, c, d, x, s, t) {
                return cmn((b & d) | (c & (~d)), a, b, x, s, t);
            }

            function hh(a, b, c, d, x, s, t) {
                return cmn(b ^ c ^ d, a, b, x, s, t);
            }

            function ii(a, b, c, d, x, s, t) {
                return cmn(c ^ (b | (~d)), a, b, x, s, t);
            }

            function md51(s) {
                var n = s.length,
                    state = [1732584193, -271733879, -1732584194, 271733878], i;
                for (i = 64; i <= s.length; i += 64) {
                    md5cycle(state, md5blk(s.substring(i - 64, i)));
                }
                s = s.substring(i - 64);
                var tail = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                for (i = 0; i < s.length; i++)
                    tail[i >> 2] |= s.charCodeAt(i) << ((i % 4) << 3);
                tail[i >> 2] |= 0x80 << ((i % 4) << 3);
                if (i > 55) {
                    md5cycle(state, tail);
                    for (i = 0; i < 16; i++) tail[i] = 0;
                }
                tail[14] = n * 8;
                md5cycle(state, tail);
                return state;
            }

            function md5blk(s) {
                var md5blks = [], i;
                for (i = 0; i < 64; i += 4) {
                    md5blks[i >> 2] = s.charCodeAt(i)
                        + (s.charCodeAt(i + 1) << 8)
                        + (s.charCodeAt(i + 2) << 16)
                        + (s.charCodeAt(i + 3) << 24);
                }
                return md5blks;
            }

            var hex_chr = '0123456789abcdef'.split('');

            function rhex(n) {
                var s = '', j = 0;
                for (; j < 4; j++)
                    s += hex_chr[(n >> (j * 8 + 4)) & 0x0F]
                        + hex_chr[(n >> (j * 8)) & 0x0F];
                return s;
            }

            function hex(x) {
                for (var i = 0; i < x.length; i++)
                    x[i] = rhex(x[i]);
                return x.join('');
            }

            function add32(a, b) {
                return (a + b) & 0xFFFFFFFF;
            }

            return hex(md51(string));
        }

        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        function checkLoginStatus() {
            const sessionData = localStorage.getItem(AUTH_CONFIG.sessionKey);
            if (sessionData) {
                const session = JSON.parse(sessionData);
                const now = Date.now();
                if (now - session.timestamp < AUTH_CONFIG.sessionDuration) {
                    return true;
                } else {
                    localStorage.removeItem(AUTH_CONFIG.sessionKey);
                }
            }
            return false;
        }

        // å¤„ç†ç™»å½•
        function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // ç®€åŒ–éªŒè¯ï¼šç›´æ¥æ¯”å¯¹å­—ç¬¦ä¸²ï¼ˆæ›´å¯é ï¼‰
            if (username === 'admin' && password === 'admin123') {
                // ç™»å½•æˆåŠŸ
                const sessionData = {
                    username: username,
                    timestamp: Date.now()
                };
                localStorage.setItem(AUTH_CONFIG.sessionKey, JSON.stringify(sessionData));

                // æ˜¾ç¤ºç®¡ç†ç•Œé¢
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';

                // åˆå§‹åŒ–æ¸¸æˆåˆ—è¡¨
                loadGamesList();
            } else {
                // ç™»å½•å¤±è´¥
                document.getElementById('loginError').style.display = 'block';
                document.getElementById('password').value = '';
            }
        }

        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem(AUTH_CONFIG.sessionKey);
            location.reload();
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€
        window.addEventListener('DOMContentLoaded', function() {
            if (checkLoginStatus()) {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                // åŠ è½½æ¸¸æˆåˆ—è¡¨
                loadGamesList();
            }
        });

        let allGames = [];
        let currentGameData = null;
        let currentGameFile = null;
        let updatedGameData = null;

        // åŠ è½½æ¸¸æˆåˆ—è¡¨
        async function loadGamesList() {
            try {
                const response = await fetch('games.json');
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½æ¸¸æˆåˆ—è¡¨');
                const games = await response.json();
                allGames = games;

                // æ›´æ–°ä¸¤ä¸ªä¸‹æ‹‰æ¡†
                const options = '<option value="">è¯·é€‰æ‹©æ¸¸æˆ...</option>' +
                    games.map(g => `<option value="${g.file}">${g.icon} ${g.name}</option>`).join('');

                document.getElementById('gameSelect').innerHTML = options;
                document.getElementById('batchGameSelect').innerHTML = options;
            } catch (error) {
                console.error('åŠ è½½æ¸¸æˆåˆ—è¡¨å¤±è´¥:', error);
                showMessage('æ— æ³•åŠ è½½æ¸¸æˆåˆ—è¡¨', 'error');
            }
        }

        // åˆ‡æ¢æ ‡ç­¾é¡µ
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        // åŠ è½½æ¸¸æˆæ•°æ®
        async function loadGameData() {
            const gameFile = document.getElementById('gameSelect').value;
            if (!gameFile) {
                document.getElementById('currentFieldsBox').classList.add('hidden');
                currentGameData = null;
                currentGameFile = null;
                return;
            }

            try {
                const response = await fetch(gameFile);
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½æ•°æ®æ–‡ä»¶');
                const data = await response.json();
                currentGameData = data;
                currentGameFile = gameFile;

                // æ˜¾ç¤ºå½“å‰å­—æ®µ
                const fields = Object.keys(data);
                document.getElementById('currentFields').innerHTML =
                    fields.map(f => `<span class="field-tag">${f}</span>`).join('');
                document.getElementById('currentFieldsBox').classList.remove('hidden');

                // æ›´æ–°datalist
                document.getElementById('existingFields').innerHTML =
                    fields.map(f => `<option value="${f}">`).join('');
            } catch (error) {
                console.error('åŠ è½½æ¸¸æˆæ•°æ®å¤±è´¥:', error);
                showMessage('æ— æ³•åŠ è½½æ¸¸æˆæ•°æ®', 'error');
            }
        }

        // æ·»åŠ æ•°æ®
        function addData() {
            if (!currentGameData || !currentGameFile) {
                showMessage('è¯·å…ˆé€‰æ‹©æ¸¸æˆ', 'error');
                return;
            }

            const fieldName = document.getElementById('fieldName').value.trim();
            const fieldValue = document.getElementById('fieldValue').value.trim();

            if (!fieldName) {
                showMessage('è¯·è¾“å…¥å­—æ®µåç§°', 'error');
                return;
            }

            if (!fieldValue) {
                showMessage('è¯·è¾“å…¥å­—æ®µå€¼', 'error');
                return;
            }

            // å¤åˆ¶æ•°æ®
            updatedGameData = JSON.parse(JSON.stringify(currentGameData));

            // åˆ›å»ºå­—æ®µï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if (!updatedGameData[fieldName]) {
                updatedGameData[fieldName] = [];
            }

            // æ·»åŠ å€¼
            const values = fieldValue.split('\n').map(v => v.trim()).filter(v => v);
            const added = [];
            const skipped = [];

            values.forEach(v => {
                if (!updatedGameData[fieldName].includes(v)) {
                    updatedGameData[fieldName].push(v);
                    added.push(v);
                } else {
                    skipped.push(v);
                }
            });

            // æ˜¾ç¤ºé¢„è§ˆ
            showPreview(fieldName, added, skipped);
            showMessage(`æˆåŠŸæ·»åŠ  ${added.length} ä¸ªå€¼${skipped.length > 0 ? `ï¼Œè·³è¿‡ ${skipped.length} ä¸ªé‡å¤å€¼` : ''}`, 'success');

            // æ˜¾ç¤ºä¸‹è½½å’Œå‘½ä»¤åŒºåŸŸ
            document.getElementById('downloadBox').classList.remove('hidden');
            document.getElementById('commandBox').classList.remove('hidden');

            // ç”ŸæˆGitå‘½ä»¤
            generateCommands(fieldName, added);
        }

        // æ˜¾ç¤ºé¢„è§ˆ
        function showPreview(fieldName, added, skipped) {
            const preview = {
                game: currentGameFile.replace('.json', ''),
                field: fieldName,
                added: added,
                skipped: skipped,
                totalInField: updatedGameData[fieldName].length
            };

            document.getElementById('previewContent').textContent = JSON.stringify(preview, null, 2);
            document.getElementById('previewBox').classList.remove('hidden');
        }

        // ç”ŸæˆGitå‘½ä»¤
        function generateCommands(fieldName, added) {
            const gameName = currentGameFile.replace('.json', '');
            const timestamp = new Date().toISOString().replace('T', ' ').substring(0, 19);
            const valueStr = added.length === 1 ? added[0] : `${added.length}ä¸ªæ–°å€¼`;

            const command = `# 1. ä¸‹è½½JSONæ–‡ä»¶å¹¶æ›¿æ¢æœ¬åœ°æ–‡ä»¶
# 2. è¿è¡Œä»¥ä¸‹å‘½ä»¤æäº¤åˆ°GitHub

git add ${currentGameFile} updates.json
git commit -m "Update ${gameName}: ${fieldName} - ${valueStr}"
git push`;

            document.getElementById('commandContent').textContent = command;
        }

        // ä¸‹è½½JSON
        function downloadJSON() {
            if (!updatedGameData) return;

            const jsonStr = JSON.stringify(updatedGameData, ensureUnicode, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = currentGameFile;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            // åŒæ—¶ç”Ÿæˆå¹¶ä¸‹è½½æ›´æ–°æ—¥å¿—
            downloadUpdateLog();
        }

        // ç¡®ä¿ä¸­æ–‡æ­£ç¡®æ˜¾ç¤º
        function ensureUnicode(key, value) {
            return value;
        }

        // ä¸‹è½½æ›´æ–°æ—¥å¿—
        async function downloadUpdateLog() {
            try {
                const response = await fetch('updates.json');
                const updates = await response.json();

                const fieldName = document.getElementById('fieldName').value.trim();
                const fieldValue = document.getElementById('fieldValue').value.trim();
                const values = fieldValue.split('\n').map(v => v.trim()).filter(v => v);
                const gameName = currentGameFile.replace('.json', '');

                // åˆ›å»ºæ–°çš„æ›´æ–°è®°å½•
                const newUpdate = {
                    time: new Date().toLocaleString('zh-CN', { hour12: false }).replace(/\//g, '-'),
                    game: gameName,
                    updates: {}
                };

                // æ£€æŸ¥å“ªäº›å€¼æ˜¯æ–°æ·»åŠ çš„
                const addedValues = values.filter(v => !currentGameData[fieldName]?.includes(v));
                if (addedValues.length > 0) {
                    newUpdate.updates[fieldName] = addedValues.length === 1 ? addedValues[0] : `${addedValues.length}ä¸ªæ–°å€¼`;
                }

                // æ·»åŠ åˆ°æ›´æ–°æ—¥å¿—å¼€å¤´
                updates.unshift(newUpdate);

                // ä¸‹è½½æ›´æ–°æ—¥å¿—
                const jsonStr = JSON.stringify(updates.slice(0, 100), ensureUnicode, 2);
                const blob = new Blob([jsonStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);

                const a = document.createElement('a');
                a.href = url;
                a.download = 'updates.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('ä¸‹è½½æ›´æ–°æ—¥å¿—å¤±è´¥:', error);
            }
        }

        // ä¸‹è½½Pythonè„šæœ¬
        function downloadPythonScript() {
            if (!updatedGameData) return;

            const fieldName = document.getElementById('fieldName').value.trim();
            const fieldValue = document.getElementById('fieldValue').value.trim();
            const values = fieldValue.split('\n').map(v => v.trim()).filter(v => v);
            const addedValues = values.filter(v => !currentGameData[fieldName]?.includes(v));
            const gameName = currentGameFile.replace('.json', '');

            const script = `#!/usr/bin/env python3
# -*- coding: utf-8 -*-
\"\"\"
è‡ªåŠ¨æ›´æ–°è„šæœ¬ - ç”Ÿæˆäº ${new Date().toLocaleString('zh-CN')}
æ¸¸æˆ: ${gameName}
å­—æ®µ: ${fieldName}
\"\"\"
import json

def update_game_data():
    json_file = "${currentGameFile}"

    # è¯»å–ç°æœ‰æ•°æ®
    try:
        with open(json_file, 'r', encoding='utf-8') as f:
            data = json.load(f)
    except FileNotFoundError:
        print(f"[ERROR] æ–‡ä»¶ä¸å­˜åœ¨: {json_file}")
        return

    # ç¡®ä¿å­—æ®µå­˜åœ¨
    if "${fieldName}" not in data:
        data["${fieldName}"] = []

    # æ·»åŠ æ–°å€¼
    new_values = ${JSON.stringify(addedValues)}
    added = 0
    for value in new_values:
        if value and value not in data["${fieldName}"]:
            data["${fieldName}"].append(value)
            added += 1
            print(f"[OK] ${gameName} - ${fieldName}: {value}")

    # ä¿å­˜æ•°æ®
    with open(json_file, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    print(f"\\n[SUCCESS] å·²æ·»åŠ  {added} ä¸ªæ–°å€¼")

    # æ›´æ–°æ—¥å¿—
    try:
        with open('updates.json', 'r', encoding='utf-8') as f:
            updates = json.load(f)
    except:
        updates = []

    from datetime import datetime
    update_log = {
        "time": datetime.now().strftime('%Y-%m-%d %H:%M:%S'),
        "game": "${gameName}",
        "updates": {
            "${fieldName}": "${addedValues.length === 1 ? addedValues[0] : addedValues.length + 'ä¸ªæ–°å€¼'}"
        }
    }
    updates.insert(0, update_log)

    with open('updates.json', 'w', encoding='utf-8') as f:
        json.dump(updates[:100], f, ensure_ascii=False, indent=2)

    print("[SUCCESS] æ›´æ–°æ—¥å¿—å·²è®°å½•")
    print("\\nè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤æäº¤åˆ°GitHub:")
    print('  git add ${currentGameFile} updates.json')
    print('  git commit -m "Update ${gameName}: ${fieldName}"')
    print("  git push")

if __name__ == "__main__":
    update_game_data()
`;

            const blob = new Blob([script], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);

            const a = document.createElement('a');
            a.href = url;
            a.download = `update_${gameName}_${fieldName}.py`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // æ¸…ç©ºè¡¨å•
        function clearForm() {
            document.getElementById('fieldName').value = '';
            document.getElementById('fieldValue').value = '';
            document.getElementById('previewBox').classList.add('hidden');
            document.getElementById('downloadBox').classList.add('hidden');
            document.getElementById('commandBox').classList.add('hidden');
            document.getElementById('messageBox').innerHTML = '';
            updatedGameData = null;
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type) {
            const className = type === 'success' ? 'success-message' : 'error-message';
            document.getElementById('messageBox').innerHTML = `<div class="${className}">${text}</div>`;
        }

        // æ‰¹é‡æ·»åŠ 
        async function loadBatchGameData() {
            const gameFile = document.getElementById('batchGameSelect').value;
            // å¯ä»¥åœ¨è¿™é‡Œé¢„åŠ è½½æ¸¸æˆæ•°æ®ç”¨äºéªŒè¯
        }

        function batchAddData() {
            showMessage('æ‰¹é‡æ·»åŠ åŠŸèƒ½å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…', 'error');
        }

        function loadBatchTemplate() {
            const template = {
                "å­—æ®µå1": "å•ä¸ªå€¼",
                "å­—æ®µå2": ["å€¼1", "å€¼2", "å€¼3"],
                "å­—æ®µå3": ["å¯ä»¥ä¸€æ¬¡æ·»åŠ å¤šä¸ªå€¼"]
            };
            document.getElementById('batchData').value = JSON.stringify(template, null, 2);
        }

        // åˆå§‹åŒ–ï¼ˆç™»å½•åè°ƒç”¨ï¼‰
        function initAfterLogin() {
            loadGamesList();
        }
    </script>
</body>
</html>
